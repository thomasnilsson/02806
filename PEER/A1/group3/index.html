<!DOCTYPE html>
<html lang="en">
	<head>
		<!-- Theme Made By www.w3schools.com - No Copyright -->
		<title>02806 Social Data Analysis and Visualization</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<script src="https://d3js.org/d3.v4.js"></script>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
		<link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet" type="text/css">
		<link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet" type="text/css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
		<style>
		body {
			font: 400 15px Lato, sans-serif;
			line-height: 1.8;
			color: #818181;
		}
		h2 {
			font-size: 24px;
			text-transform: uppercase;
			color: #303030;
			font-weight: 600;
			margin-bottom: 30px;
		}
		h4 {
			font-size: 19px;
			line-height: 1.375em;
			color: #303030;
			font-weight: 400;
			margin-bottom: 30px;
		}
		.jumbotron {
			background-color: #1abc9c;
			color: #fff;
			padding: 100px 25px;
			font-family: Montserrat, sans-serif;
		}
		.container-fluid {
			padding: 60px 50px;
		}
		.bg-grey {
			background-color: #f6f6f6;
		}
		.panel {
			border: 1px solid #f4511e;
			border-radius:0 !important;
			transition: box-shadow 0.5s;
		}
		.panel:hover {
			box-shadow: 5px 0px 40px rgba(0,0,0, .2);
		}
		.panel-footer .btn:hover {
			border: 1px solid #f4511e;
			background-color: #fff !important;
			color: #f4511e;
		}
		.panel-heading {
			color: #fff !important;
			background-color: #f4511e !important;
			padding: 25px;
			border-bottom: 1px solid transparent;
			border-top-left-radius: 0px;
			border-top-right-radius: 0px;
			border-bottom-left-radius: 0px;
			border-bottom-right-radius: 0px;
		}
		.panel-footer {
			background-color: white !important;
		}
		.panel-footer h3 {
			font-size: 32px;
		}
		.panel-footer h4 {
			color: #aaa;
			font-size: 14px;
		}
		.panel-footer .btn {
			margin: 15px 0;
			background-color: #f4511e;
			color: #fff;
		}
		.navbar {
			margin-bottom: 0;
			background-color: #1abc9c;
			z-index: 9999;
			border: 0;
			font-size: 12px !important;
			line-height: 1.42857143 !important;
			letter-spacing: 4px;
			border-radius: 0;
			font-family: Montserrat, sans-serif;
		}
		.navbar li a, .navbar .navbar-brand {
			color: #fff !important;
		}
		.navbar-nav li a:hover, .navbar-nav li.active a {
			color: #1abc9c !important;
			background-color: #fff !important;
		}
		.navbar-default .navbar-toggle {
			border-color: transparent;
			color: #fff !important;
		}
		footer .glyphicon {
			font-size: 20px;
			margin-bottom: 20px;
			color: #1abc9c;
		}
		.slideanim {visibility:hidden;}
		.slide {
			animation-name: slide;
			-webkit-animation-name: slide;
			animation-duration: 1s;
			-webkit-animation-duration: 1s;
			visibility: visible;
		}
		@keyframes slide {
		0% {
			opacity: 0;
			transform: translateY(70%);
		}
		100% {
			opacity: 1;
			transform: translateY(0%);
		}
		}
		@-webkit-keyframes slide {
		0% {
			opacity: 0;
			-webkit-transform: translateY(70%);
		}
		100% {
			opacity: 1;
			-webkit-transform: translateY(0%);
		}
		}
		@media screen and (max-width: 768px) {
		.col-sm-4 {
			text-align: center;
			margin: 25px 0;
		}
		.btn-lg {
			width: 100%;
			margin-bottom: 35px;
		}
		}
		#tooltip {
			position: absolute;
			width: 150px;
			height: auto;
			padding: 5px;
			background-color: white;
			-webkit-border-radius: 10px;
			-moz-border-radius: 10px;
			border-radius: 10px;
			-webkit-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
			-moz-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
			box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
			pointer-events: none;
			z-index: 1;
		}
		#tooltip.hidden {
			visibility: hidden;
		}
		#tooltip p {
			margin: 0;
			font-family: sans-serif;
			font-size: 14px;
		}
		path.hidden,circle.hidden,line.hidden {
			display: none;
		}
		</style>
	</head>
	<body id="myPage" data-spy="scroll" data-target=".navbar" data-offset="60">
		<nav class="navbar navbar-default navbar-fixed-top">
			<div class="container">
				<div class="navbar-header">
					<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					</button>
					<a class="navbar-brand" href="#myPage"></a>
				</div>
				<div class="collapse navbar-collapse" id="myNavbar">
					<ul class="nav navbar-nav navbar-right">
					<li><a href="#part1">PART 1</a></li>
					<li><a href="#part2">PART 2</a></li>
					<li><a href="#part3">PART 3</a></li>
					<li><a href="#part4">PART 4</a></li>
					</ul>
				</div>
			</div>
		</nav>

		<div class="jumbotron text-center">
			<h1 style="font-size: 32px;">02806 - Social Data Analysis and Visualization</h1>
			<h2 style="color: white;">Assignment 1</h2>
		</div>

		<!-- Container (Part 1 Section) -->
		<div id="part1" class="container-fluid">
			<div class="row">
				<div class="col-sm-12">
					<h2>Part 1: DAOST Chapter 2 Questions</h2><br>
					<ul>
						<li><strong>What it the point of a jitter plot?</strong> A jitter plot is a 2-dimensional plot of one of the variables where you add some noise in either the vertical or horizontal axis to visualize all the observations because some observations might have the same value and would therefore overlap.</li>
						<li><strong>Explain figure 2-3 from IDV.</strong> The figure shows the importance of corretly binning and how the bin intervals affect the presentation. Since both the plots in the figure is a plot of the same data but look very different.</li>
						<li><strong>When can KDEs be misleading?</strong> The kernel density estimation is distorting the way you see data and therefore doesn't give you a correct interpertation of the data.</li>
						<li><strong>What are the strengths and weaknesses of CDF?</strong> CDF is harder to extract the same information from than the histograms. As what is the probability of an observation being in this region. But it is good at detecting how much of the data is below and above some point.</li>
						<li><strong>What is a 'Quantile plot' and what is it good for?</strong> A quantile plot is if you change the y- and x-axis of the cdf plot. It is good for answering questions like "what is the BMI corresponding to the 8th percentile of BMIs?".</li>
						<li><strong>How is a 'Probablity plot' defined and what is it useful for?</strong> A probability plot is a plot that compares the data to a distribution. And is defined as finding the inverse of the distribution to check for and applying that to the output (response variable). It is therefore easy to check if the data follows a gaussian distribution if it follows a straight line.</li>
						<li><strong>Why do you have to be carefull about only using summary statistics and why is visualization of data always better?</strong> Mean, median and related summary statistics can all be misleading as shown in some of the videos since you can constuct data such that for example the mean is zero but that might be that all data is placed at -1 and 1 instead of 0. And equal cases can be constructed for remaining statistics.</li>
						<li><strong>When are box plots most useful?</strong> Box plots is good for displaying the distribution, to check if the distributions is symmetric and how the data is distributed around the central peak and tails. It is also good at displaying outliers and for comparing distributions against each other.</li>
						<li><strong>Are violin plots better or worse than box plots?</strong> Violin plots are better than box plots at displaying if there are more than one peak in the data.</li>
					</ul>
				</div>
			</div>
		</div>

		<!-- Container (Part 2 Section) -->
		<div id="part2" class="container-fluid bg-grey">
			<div class="row">
				<div class="col-sm-12">
					<h2>Part 2: DAOST Chapter 3 Questions</h2><br>
					<ul>
						<li><strong>What is Janerts argument when he writes: "the data itself shows clearly that the amount of random noise in the data is small" in Fig 3-1?</strong> That since the data clearly follows a nice and smooth curve then we know that the noise is small in the data.</li>
						<li><strong>Can you think of a real-world example of a multivariate relationship like the one in Fig 3-3?</strong> One example could be that we would like study if family environment, parents educational level, family wealth and type of neighbourhood are predictors of educational level and future job.</li>
						<li><strong>What are the two methods Janert metions for smoothing noisy data? Can you think of other ones?</strong> Janert first mentions Splines which is multiple polynomials joined together in a smooth way such that the overall curve is smooth. Next Janert mentions LOESS which is a kind of weighted regression that puts higher weights to the points of interest. Other examples could be a moving average or a Kalman filter for smoothing.</li>
						<li><strong>What are residuals and why is it a good idea to plot the residuals of your fit?</strong> Residuals is the remainder when you subtract the smooth trend from the actual data. It is a good idea to plot the residuals since many statistical methods assume that the residuals are symmetrically distributed around zero and are independent of the trend.</li>
						<li><strong>Explain in your own words the point of the smooth tube in figure 3-7.</strong> The smooth tube is constructed by three approximations. The solid line is constructed with a smooth approximation of the entire data set, the dashed line below and above are constructed with smooth approximations of the data that lie above or below the solid line. This can be used for finding outliers that would affect the smooth approximation since that would make the bandwidth of the three approximations vary.</li>
						<li><strong>What kind of relationships will a semi-log plot help you discover?</strong> Semi-log plots are great for discovering the offset and the scale factor of an exponential function.</li>
						<li><strong>What kind of functions will loglog plots help you see?</strong> Loglog plots are great for visualizing power-law relations as straight lines since the loglog transformation turns the power function into a linear function and then its easy to exponent and scaling factor.</li>
						<li><strong>What is 'banking' and what element from our visual system does it use? What are potential problems with banking?</strong> Banking is a technique that changes the aspect ratio of the plot such that the line segments lie on a 45 degree angle. This helps our visual system to detect important features of the data but shrinking the axes to much would lose a lot information and it becomes too difficult to compare the tails of the data.</li>
						<li><strong>What is the important point about linear fits that is rarely made from Fig 3-14?</strong> The important point is that if you fit any data with some linear fit its important to note that the best linear fit depends on the response variable. So if you change the response variable then the best fit also changes since we are using the fit as a predictor and not a smoothing curve.</li>
						<li><strong>Summarize the discussion of 'Graphical Analysis' and 'Presentation Graphics'.</strong> The 'Graphical Analysis' is a way of exploring the data to get key insights on the data such that we can find the underlying representation or whatever desired. The 'Presentation Graphics' are all about communicating the information that have been discovered in a clearly way. The remainder of the discussion is about how to prepare good graphs like keeping it simple, self explanatory, having understandable axis labels and making sure that the graph scales and such.</li>
					</ul>
				</div>
			</div>
		</div>

		<!-- Container (Part 3 Section) -->
		<div id="part3" class="container-fluid">
			<div class="row">
				<div class="col-sm-6">
					<div id="barplot">
						<div class="dropdown">
							<button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown">Categories<span class="caret"></span></button>
							<ul class="dropdown-menu" id="button_pl1">
								<li class="active" style="color: white"><a id="Fruits_Harvest">Fruits Harvest</a></li>
								<li><a id="Fruits_Storage">Fruits Storage</a></li>
								<li><a id="Vegetables_Harvest">Vegetables Harvest</a></li>
								<li><a id="Vegetables_Storage">Vegetables Storage</a></li>
							</ul>
						</div>
						<div id="tooltip" class="hidden">
							<p>Year: <span id="year">0</span></p>
							<p>Time: <span id="time">0</span></p>
						</div>
					</div>
				</div>
				<div class="col-sm-6">
					<h2>Part 3: Viz 1</h2><br>
					<h4>This is a reproduction of <a href="http://iquantny.tumblr.com/post/129373499164/this-is-quantifiably-the-best-month-to-go-to-the">This is Quantifiably the Best Month to go to the Farmers Market</a></h4>
					<p>As part of a homework assignment, I ask my students at Pratt to go out and chart something of interest to them, and <a href="https://t.umblr.com/redirect?z=https%3A%2F%2Fwww.linkedin.com%2Fin%2Fkvsavarese&amp;t=NmE2YmYyYjU4NTI3MTFhYWFiMWE1ZjFhNzc1NmUzMmE0ZDQ4OGM2NSwxeHM2a1phNg%3D%3D&amp;b=t%3A5jlxwUw4OZ-2SbgNDPgKMQ&amp;p=http%3A%2F%2Fiquantny.tumblr.com%2Fpost%2F129373499164%2Fthis-is-quantifiably-the-best-month-to-go-to-the&amp;m=1">Katherine Savarese</a> came back with a simple chart about farmers markets that I loved- it inspired this post.</p>
		        	<p>You probably know that farmers markets are a staple across <a href="https://t.umblr.com/redirect?z=http%3A%2F%2Fwww.grownyc.org%2Ffiles%2Fgmkt%2Fmap.pdf&amp;t=MGM4YmRjZjQ2ZmFmYzBiYmMzMmY5NDU2MTdiNzMzMmYyOWQ5YjQ2ZSwxeHM2a1phNg%3D%3D&amp;b=t%3A5jlxwUw4OZ-2SbgNDPgKMQ&amp;p=http%3A%2F%2Fiquantny.tumblr.com%2Fpost%2F129373499164%2Fthis-is-quantifiably-the-best-month-to-go-to-the&amp;m=1">all five boroughs</a> of New York City, but September happens to be a very special month.  Why is that? &nbsp;Well, it turns out September is the month with the most unique types of fresh produce- forty three to be exact.</p>
		        	<p>To show the current offerings, we charted how many types of fruits and vegetables are available by month, and showed if they were fresh or from storage.&nbsp;</p>
		        	<p>If you miss the month of September, you might be behind the fruit curve, but there are plenty more months of vegetables left. &nbsp;The chart shows that fresh vegetables are available 9 out of 12 months, but fruit is only available 5 out of 12. Now if only we could quantify how delicious the produce isâ€¦&nbsp;</p>
		        	<p>-----</p>
		        	<p>Data from:&nbsp;<a href="https://t.umblr.com/redirect?z=http%3A%2F%2Fwww.grownyc.org%2Fgreenmarket%2Fwhatsavailable&amp;t=MWU3YTNhNmYwMDJkNWUwNWQzOTUwMTZjMzJlMGNhM2E3YzdlNTIxMCwxeHM2a1phNg%3D%3D&amp;b=t%3A5jlxwUw4OZ-2SbgNDPgKMQ&amp;p=http%3A%2F%2Fiquantny.tumblr.com%2Fpost%2F129373499164%2Fthis-is-quantifiably-the-best-month-to-go-to-the&amp;m=1">http://www.grownyc.org/greenmarket/whatsavailable</a></p>
				</div>
			</div>
		</div>

		<!-- Container (Part 4 Section) -->
		<div id="part4" class="container-fluid bg-grey">
			<div class="row">
				<div class="col-sm-6">
					<h2>Part 4: Viz 2</h2><br>
					<p>This is a representation of the Boston marathon winning times for both men and women. Under the button categories you can select which data you want displayed and if you let the mouse hover over a point in the graph it would display the actual data point. The black dashed lines are the best linear fit for all the data for each of the two classes this is done with pure D3 skills!</p><br>
					<p>As you might notice the women started participating in the marathon a lot later than the men. This might be due to the women not allowed to participate or the simply could only participate in the male categori.</p>
				</div>
				<div class="col-sm-6">
					<div id="marathon_plot">
						<div class="dropdown">
							<button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown">Categories<span class="caret"></span></button>
							<ul class="dropdown-menu" id="button_pl2">
								<li class="active" style="color: white"><a id="all">All data</a></li>
								<li><a id="men">Men</a></li>
								<li><a id="women">Women</a></li>
							</ul>
						</div>
						<div id="tooltip" class="hidden">
							<p>Year: <span id="year">0</span></p>
							<p>Time: <span id="time">0</span></p>
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- Container (Footer Section) -->
		<footer class="container-fluid text-center">
			<a href="#myPage" title="To Top">
			<span class="glyphicon glyphicon-chevron-up"></span>
			</a>
			<p>Scroll to the top of the page</p>
		</footer>

		<script>
		$(document).ready(function(){
			// Add smooth scrolling to all links in navbar + footer link
			$(".navbar a, footer a[href='#myPage']").on('click', function(event) {
				// Make sure this.hash has a value before overriding default behavior
				if (this.hash !== "") {
					// Prevent default anchor click behavior
					event.preventDefault();

					// Store hash
					var hash = this.hash;

					// Using jQuery's animate() method to add smooth page scroll
					// The optional number (900) specifies the number of milliseconds it takes to scroll to the specified area
					$('html, body').animate({
					scrollTop: $(hash).offset().top
					}, 900, function(){

					// Add hash (#) to URL when done scrolling (default click behavior)
					window.location.hash = hash;
					});
				} // End if
			});

			$(window).scroll(function() {
				$(".slideanim").each(function(){
					var pos = $(this).offset().top;

					var winTop = $(window).scrollTop();
					if (pos < winTop + 600) {
						$(this).addClass("slide");
					}
				});
			});
		})
		</script>
		<script type="text/javascript">
        	function addToBar(bar,data,prop,propScale,xScale,w,h,padding,color) {
        		// axis
            	var yAxis = d3.axisLeft().scale(propScale).ticks(5);

            	// add axis to plot
                bar.select(".y.axis").transition().duration(1000).call(yAxis);

        		// add bars to plot
                bar.selectAll("rect").data(data).transition().duration(1000).attr("x",function(d,i) { return xScale(i); }).attr("y",function(d) { return propScale(d[prop]); }).attr("width",xScale.bandwidth()).attr("height",function(d) { return h-propScale(d[prop])-padding; }).attr("fill",function(d) { return color; });
        	}

        	// settings for window
        	var w = 800;
        	var h = 450;
        	var padding = 50;

        	// create window for plot
            var bar = d3.select("div[id=barplot]").append("svg").attr("width",w).attr("height",h);

            // load data
            d3.csv("green_market_processed.csv",function(error,dataset) {
            	var maxFH = 0;
            	var maxFS = 0;
            	var maxVH = 0;
            	var maxVS = 0;
            	var maxRow = 0;
            	for (var i = 0; i < dataset.length; i++) {
            		if (+dataset[i].Fruits_Harvest > maxFH) { maxFH = +dataset[i].Fruits_Harvest};
            		if (+dataset[i].Fruits_Storage > maxFS) { maxFS = +dataset[i].Fruits_Storage};
            		if (+dataset[i].Vegetables_Harvest > maxVH) { maxVH = +dataset[i].Vegetables_Harvest};
            		if (+dataset[i].Vegetables_Storage > maxVS) { maxVS = +dataset[i].Vegetables_Storage};
            		if (+dataset[i].row_sum > maxRow) { maxRow = +dataset[i].row_sum};
            	}

            	// scales
            	var xScale = d3.scaleBand().domain(d3.range(dataset.length)).rangeRound([padding,w-padding*3]).paddingInner(0.05);
            	var FHScale = d3.scaleLinear().domain([0,maxFH]).range([h-padding,padding]);
            	var FSScale = d3.scaleLinear().domain([0,maxFS]).range([h-padding,padding]);
            	var VHScale = d3.scaleLinear().domain([0,maxVH]).range([h-padding,padding]);
            	var VSScale = d3.scaleLinear().domain([0,maxVS]).range([h-padding,padding]);

            	// axis
            	var xAxis = d3.axisBottom().scale(xScale).tickValues(d3.range(dataset.length)).tickFormat(function(d,i) { return dataset[i].month;})
            	var yAxis = d3.axisLeft().scale(FHScale).ticks(5);

            	// add axis labels and title
				bar.append("text").attr("x",(w/2)-padding).attr("y",0+(padding/2)).attr("text-anchor","middle").style("font-size","16px").style("text-decoration", "underline").text("NYC Green Markets - Unique Produce Types");
				bar.append("text").attr("x",w/2-padding).attr("y",h).style("text-anchor","middle").text("Month");
				bar.append("text").attr("x",-(h/2)).attr("y",0).attr("transform","rotate(-90)").attr("dy","1em").style("text-anchor","middle").text("# of Unique Kinds of Products");

            	// add bars to plot
                bar.selectAll("rect").data(dataset).enter().append("rect").attr("x",function(d,i) { return xScale(i); }).attr("y",function(d) { return FHScale(d.Fruits_Harvest); }).attr("width",xScale.bandwidth()).attr("height",function(d) { return h-FHScale(d.Fruits_Harvest)-padding; }).attr("fill",function(d) { return 'red'; });

                // add axis to plot
            	bar.append("g").attr("class","x axis").attr("transform","translate(0,"+(h-padding)+")").call(xAxis);
            	bar.append("g").attr("class","y axis").attr("transform","translate("+padding+",0)").call(yAxis);

            	// add legends to plot
				var color = d3.scaleOrdinal().domain(["Fresh Fruit","Storage Fruit","Fresh Vegetable","Storage Vegetable"]).range(["red","pink","green","grey"]);
				var legendRectSize = 15;
				var legendSpacing = 5;
				var legend = bar.append("g").attr('id','legendContainer').selectAll("g").data(color.domain()).enter().append('g').attr('class','legend').attr('transform',function(d,i) {
					var height = legendRectSize;
					var x = w-padding*2.8;
					var y = i * height+padding;
					return 'translate('+x+','+y+')';
				});
				legend.append('rect').attr('width',legendRectSize).attr('height',legendRectSize).style('fill',color).style('stroke',color);
				legend.append('text').attr('x',legendRectSize+legendSpacing).attr('y',legendRectSize-legendSpacing).text(function(d) { return d; });

                // the following are event listeners to update barplot on click
	        	d3.select("a[id=Fruits_Harvest]").on("click",function() {
	        		d3.select("ul[id=button_pl1]").selectAll("li").classed("active",false).style("color","black");
	        		d3.select(this.parentNode).classed("active",true).style("color","white");
	        		addToBar(bar,dataset,'Fruits_Harvest',FHScale,xScale,w,h,padding,'red');
	        		return false;
	        	});
	        	d3.select("a[id=Fruits_Storage]").on("click",function() {
	        		d3.select("ul[id=button_pl1]").selectAll("li").classed("active",false).style("color","black");
	        		d3.select(this.parentNode).classed("active",true).style("color","white");
	        		addToBar(bar,dataset,'Fruits_Storage',FSScale,xScale,w,h,padding,'pink');
	        		return false;
	        	});
	        	d3.select("a[id=Vegetables_Harvest]").on("click",function() {
	        		d3.select("ul[id=button_pl1]").selectAll("li").classed("active",false).style("color","black");
	        		d3.select(this.parentNode).classed("active",true).style("color","white");
	        		addToBar(bar,dataset,'Vegetables_Harvest',VHScale,xScale,w,h,padding,'green');
	        		return false;
	        	});
	        	d3.select("a[id=Vegetables_Storage]").on("click",function() {
	        		d3.select("ul[id=button_pl1]").selectAll("li").classed("active",false).style("color","black");
	        		d3.select(this.parentNode).classed("active",true).style("color","white");
	        		addToBar(bar,dataset,'Vegetables_Storage',VSScale,xScale,w,h,padding,'grey');
	        		return false;
	        	});
            });
        </script>
		<script type="text/javascript">
			// settings for window
			var w_2 = 900;
			var h_2 = 500;
			var padding = 50;

			// create window for plot
			var mar_plot = d3.select("div[id=marathon_plot]").append("svg").attr("width",w_2).attr("height",h_2);
			mar_plot.append("g").attr("id","scatter");

			var rowConverter = function(d) {
				return {
					year: +d.Year,
					date: new Date(+d.Year,1,1),
					time_men: +d.time_men,
					time_women: +d.time_women
				};
			}

			var pathD = d3.select("g[id=scatter]").selectAll("path");

			// load data
			d3.csv("boston_marathon_times.csv",rowConverter,function(error,dataset) {
				var men_min = d3.min(dataset,function(d) { return d.time_men; })
				var men_max = d3.max(dataset,function(d) { return d.time_men; })
				var women_min = d3.min(dataset,function(d) {
					if (d.time_women > 0) {
						return d.time_women;
					}
					else {
						return men_min;
					}
				});
				var women_max = d3.max(dataset,function(d) { return d.time_women; })
				var women_min_x = d3.min(dataset,function(d) {
					if (d.time_women > 0) {
						return d.date;
					}
					else {
						return null;
					}
				});

				// scales
				var xScale = d3.scaleTime().domain([
					d3.min(dataset,function(d) { return d.date; }),
					d3.max(dataset,function(d) { return d.date; })
					]).range([padding*1.5,w_2-padding]);
				var yScale = d3.scaleLinear().domain([
					d3.min([men_min,women_min]),
					d3.max([men_max,women_max])
					]).range([h_2-padding,padding]);
				var menXScale = xScale;
				var womenXScale = d3.scaleTime().domain([women_min_x,dataset[dataset.length-1].date]).range([padding*1.5,w_2-padding]);
				var menYScale = d3.scaleLinear().domain([men_min,men_max]).range([h_2-padding,padding]);
				var womenYScale = d3.scaleLinear().domain([women_min,women_max]).range([h_2-padding,padding]);

				// axis
				var xAxis = d3.axisBottom().scale(xScale);
				var yAxis = d3.axisLeft().scale(yScale);

				var diamGenerator = d3.symbol().type(d3.symbolDiamond).size(40);
				var pathDiam = diamGenerator();

				var circleGenerator = d3.symbol().type(d3.symbolCircle).size(40);
				var pathCircle = circleGenerator();

				pathD.data(dataset).enter().append('path').attr('transform',function(d) { return 'translate('+xScale(d.date)+','+yScale(d.time_men)+')'; }).attr('d',pathDiam).attr("fill","none").attr("stroke","blue").attr("class","men");
				pathD.data(dataset).enter().append("circle").attr("r",4).attr("cx",function(d) { return xScale(d.date); }).attr("cy",function(d) { return yScale(d.time_men); }).style("fill","transparent").attr("class","men").on("mouseover", function(d) {
					//Get this bar's x/y values, then augment for the tooltip
					var xPosition = xScale(d.date)+(w_2)+4;
					var yPosition = yScale(d.time_men)+h_2+padding*3-4;
					//Update the tooltip position and value
					d3.select("#tooltip").style("left",xPosition+"px").style("top",yPosition+"px").select("#year").text(d.year);
					d3.select("#tooltip").style("left",xPosition+"px").style("top",yPosition+"px").select("#time").text(d.time_men);
					//Show the tooltip
					d3.select("#tooltip").classed("hidden", false);
				}).on("mouseout",function(d) {
					d3.select("#tooltip").classed("hidden", true);
				});

				pathD.data(dataset).enter().append('path').attr('transform',function(d) { return 'translate('+xScale(d.date)+','+yScale(d.time_women)+')'; }).attr('d',pathCircle).attr("fill","none").attr("stroke","red").attr("class","women");
				pathD.data(dataset).enter().append("circle").attr("r",4).attr("cx",function(d) { return xScale(d.date); }).attr("cy",function(d) { return yScale(d.time_women); }).style("fill","transparent").attr("class","women").on("mouseover", function(d) {
					//Get this bar's x/y values, then augment for the tooltip
					var xPosition = xScale(d.date)+(w_2)+4;
					var yPosition = yScale(d.time_women)+h_2+padding*3-4;
					//Update the tooltip position and value
					d3.select("#tooltip").style("left",xPosition+"px").style("top",yPosition+"px").select("#year").text(d.year);
					d3.select("#tooltip").style("left",xPosition+"px").style("top",yPosition+"px").select("#time").text(d.time_women);
					//Show the tooltip
					d3.select("#tooltip").classed("hidden", false);
				}).on("mouseout",function(d) {
					d3.select("#tooltip").classed("hidden", true);
				});

				// add axis to plot
				mar_plot.append("g").attr("class","x axis").attr("transform","translate(0,"+(h_2-padding)+")").call(xAxis);
				mar_plot.append("g").attr("class","y axis").attr("transform","translate("+padding*1.5+",0)").call(yAxis);

				// add axis labels and title
				mar_plot.append("text").attr("x",(w_2/2)).attr("y",0+(padding/2)).attr("text-anchor","middle").style("font-size","16px").style("text-decoration", "underline").text("Winning times for annual marathon event, separately for men and women");
				mar_plot.append("text").attr("x",w_2/2).attr("y",h_2).style("text-anchor","middle").text("Year");
				mar_plot.append("text").attr("x",-(h_2/2)).attr("y",0).attr("transform","rotate(-90)").attr("dy","1em").style("text-anchor","middle").text("Winner time (in minutes)");

				// trend lines
				// for men times
				// get the x and y values for least squares
				var xLabels = dataset.map(function (d) { return d.date; });
				var xSeries = d3.range(1, xLabels.length + 1);
				var ySeries = dataset.map(function(d) { return +d.time_men; });
				var leastSquaresCoeff = leastSquares(xSeries, ySeries);
				// apply the reults of the least squares regression
				var x1 = xLabels[0];
				var y1 = leastSquaresCoeff[0] + leastSquaresCoeff[1];
				var x2 = xLabels[xLabels.length - 1];
				var y2 = leastSquaresCoeff[0] * xSeries.length + leastSquaresCoeff[1];
				var trendDataMen = [[x1,y1,x2,y2]];
				var trendline = mar_plot.selectAll(".trendline")
				var sel = trendline.data(trendDataMen).enter();
				sel.append("line").attr("class","trendline").attr("id","menTrendline").attr("x1",function(d) { return xScale(d[0]); }).attr("y1",function(d) { return yScale(d[1]); }).attr("x2",function(d) { return xScale(d[2]); }).attr("y2",function(d) { return yScale(d[3]); }).attr("stroke","black").attr("stroke-width",1).style("stroke-dasharray", ("3, 3"));

				// for women times
				var xLabels = dataset.map(function (d) {
					if (+d.time_women > 0) {
						return d.date;
					} else {
						return null;
					}
				}).filter(x => x != null);
				var xSeries = d3.range(1, xLabels.length+1);
				var ySeries = dataset.map(function(d) { return +d.time_women; }).filter(y => y > 0);
				var leastSquaresCoeff = leastSquares(xSeries,ySeries);
				// apply the reults of the least squares regression
				var x1 = xLabels[0];
				var y1 = leastSquaresCoeff[0] + leastSquaresCoeff[1];
				var x2 = xLabels[xLabels.length - 1];
				var y2 = leastSquaresCoeff[0] * xSeries[xSeries.length-1] + leastSquaresCoeff[1];
				var trendDataWomen = [[x1,y1,x2,y2]];
				var sel = trendline.data(trendDataWomen).enter();
				sel.append("line").attr("class","trendline").attr("id","womenTrendline").attr("x1",function(d) { return xScale(d[0]); }).attr("y1",function(d) { return yScale(d[1]); }).attr("x2",function(d) { return xScale(d[2]); }).attr("y2",function(d) { return yScale(d[3]); }).attr("stroke","black").attr("stroke-width",1).style("stroke-dasharray", ("3, 3"));

				// add legends to plot
				var color = d3.scaleOrdinal().domain(["Men","Women"]).range(["blue","red"]);
				var legendRectSize = 15;
				var legendSpacing = 5;
				var legend = mar_plot.append("g").attr('id','legendContainer').selectAll("g").data(color.domain()).enter().append('g').attr('class','legend').attr('transform',function(d,i) {
					var height = legendRectSize;
					var x = w_2-padding*2.5;
					var y = i * height+padding;
					return 'translate('+x+','+y+')';
				});

				legend.append('rect').attr('width',legendRectSize).attr('height',legendRectSize).style('fill',color).style('stroke',color);
				legend.append('text').attr('x',legendRectSize+legendSpacing).attr('y',legendRectSize-legendSpacing).text(function(d) { return d; });

				// the following are event listeners to update plot on click
				d3.select("a[id=all]").on("click",function() {
					d3.select("ul[id=button_pl2]").selectAll("li").classed("active",false).style("color","black");
					d3.select(this.parentNode).classed("active",true).style("color","white");
					addToPlot(mar_plot,dataset,'all',xScale,yScale,w_2,h_2,padding,trendDataMen,trendDataWomen);
					return false;
				});
				d3.select("a[id=men]").on("click",function() {
					d3.select("ul[id=button_pl2]").selectAll("li").classed("active",false).style("color","black");
					d3.select(this.parentNode).classed("active",true).style("color","white");
					addToPlot(mar_plot,dataset,'men',menXScale,menYScale,w_2,h_2,padding,trendDataMen,trendDataWomen);
					return false;
				});
				d3.select("a[id=women]").on("click",function() {
					d3.select("ul[id=button_pl2]").selectAll("li").classed("active",false).style("color","black");
					d3.select(this.parentNode).classed("active",true).style("color","white");
					addToPlot(mar_plot,dataset,'women',womenXScale,womenYScale,w_2,h_2,padding,trendDataMen,trendDataWomen);
					return false;
				});
			});

			// returns slope, intercept and r-square of the line
			function leastSquares(xSeries, ySeries) {
				var reduceSumFunc = function(prev, cur) { return prev + cur; };

				var xBar = xSeries.reduce(reduceSumFunc) * 1.0 / xSeries.length;
				var yBar = ySeries.reduce(reduceSumFunc) * 1.0 / ySeries.length;

				var ssXX = xSeries.map(function(d) { return Math.pow(d - xBar, 2); })
					.reduce(reduceSumFunc);

				var ssYY = ySeries.map(function(d) { return Math.pow(d - yBar, 2); })
					.reduce(reduceSumFunc);

				var ssXY = xSeries.map(function(d, i) { return (d - xBar) * (ySeries[i] - yBar); })
					.reduce(reduceSumFunc);

				var slope = ssXY / ssXX;
				var intercept = yBar - (xBar * slope);
				var rSquare = Math.pow(ssXY, 2) / (ssXX * ssYY);

				return [slope,intercept,rSquare];
			}

			function addToPlot(plot,dataset,prop,xscale,yscale,w,h,padding,trendDataMen,trendDataWomen) {
				// axis
				var xaxis = d3.axisBottom().scale(xscale);
				var yaxis = d3.axisLeft().scale(yscale);

				// add axis to plot
				plot.select(".x.axis").transition().duration(500).call(xaxis);
				plot.select(".y.axis").transition().duration(500).call(yaxis);

				// update plot
				var graph = d3.select("g[id=scatter]");
				//pathD.remove();
				if (prop == "all") {
					graph.selectAll("path").filter(".men").classed("hidden",false).transition().duration(500).attr('transform',function(d) { return 'translate('+xscale(d.date)+','+yscale(d.time_men)+')'; });
					graph.selectAll("circle").filter(".men").classed("hidden",false).attr("cx",function(d) { return xscale(d.date); }).attr("cy",function(d) { return yscale(d.time_men); }).style("fill","transparent").on("mouseover", function(d) {
						//Get this bar's x/y values, then augment for the tooltip
						var xPosition = xscale(d.date)+(w_2)+4;
						var yPosition = yscale(d.time_men)+h_2+padding*3-4;
						//Update the tooltip position and value
						d3.select("#tooltip").style("left",xPosition+"px").style("top",yPosition+"px").select("#year").text(d.year);
						d3.select("#tooltip").style("left",xPosition+"px").style("top",yPosition+"px").select("#time").text(d.time_men);
						//Show the tooltip
						d3.select("#tooltip").classed("hidden", false);
					}).on("mouseout",function(d) {
						d3.select("#tooltip").classed("hidden", true);
					});
					graph.selectAll("path").filter(".women").classed("hidden",false).transition().duration(500).attr('transform',function(d) { return 'translate('+xscale(d.date)+','+yscale(d.time_women)+')'; });
					graph.selectAll("circle").filter(".women").classed("hidden",false).attr("cx",function(d) { return xscale(d.date); }).attr("cy",function(d) { return yscale(d.time_women); }).style("fill","transparent").on("mouseover", function(d) {
						//Get this bar's x/y values, then augment for the tooltip
						var xPosition = xscale(d.date)+(w_2)+4;
						var yPosition = yscale(d.time_women)+h_2+padding*3-4;
						//Update the tooltip position and value
						d3.select("#tooltip").style("left",xPosition+"px").style("top",yPosition+"px").select("#year").text(d.year);
						d3.select("#tooltip").style("left",xPosition+"px").style("top",yPosition+"px").select("#time").text(d.time_women);
						//Show the tooltip
						d3.select("#tooltip").classed("hidden", false);
					}).on("mouseout",function(d) {
						d3.select("#tooltip").classed("hidden", true);
					});
					plot.select("line[id=menTrendline]").classed("hidden",false).transition().duration(500).attr("x1",function(d) { return xscale(d[0]); }).attr("y1",function(d) { return yscale(d[1]); }).attr("x2",function(d) { return xscale(d[2]); }).attr("y2",function(d) { return yscale(d[3]); });
					plot.select("line[id=womenTrendline]").classed("hidden",false).transition().duration(500).attr("x1",function(d) { return xscale(d[0]); }).attr("y1",function(d) { return yscale(d[1]); }).attr("x2",function(d) { return xscale(d[2]); }).attr("y2",function(d) { return yscale(d[3]); });
				}
				else if (prop == "men") {
					graph.selectAll("path").filter(".men").classed("hidden",false).transition().duration(500).attr('transform',function(d) { return 'translate('+xscale(d.date)+','+yscale(d.time_men)+')'; });
					graph.selectAll("circle").filter(".men").classed("hidden",false).attr("cx",function(d) { return xscale(d.date); }).attr("cy",function(d) { return yscale(d.time_men); }).style("fill","transparent").on("mouseover", function(d) {
						//Get this bar's x/y values, then augment for the tooltip
						var xPosition = xscale(d.date)+(w_2)+4;
						var yPosition = yscale(d.time_men)+h_2+padding*3-4;
						//Update the tooltip position and value
						d3.select("#tooltip").style("left",xPosition+"px").style("top",yPosition+"px").select("#year").text(d.year);
						d3.select("#tooltip").style("left",xPosition+"px").style("top",yPosition+"px").select("#time").text(d.time_men);
						//Show the tooltip
						d3.select("#tooltip").classed("hidden", false);
					}).on("mouseout",function(d) {
						d3.select("#tooltip").classed("hidden", true);
					});
					plot.select("line[id=menTrendline]").classed("hidden",false).transition().duration(500).attr("x1",function(d) { return xscale(d[0]); }).attr("y1",function(d) { return yscale(d[1]); }).attr("x2",function(d) { return xscale(d[2]); }).attr("y2",function(d) { return yscale(d[3]); });
					graph.selectAll("path").filter(".women").classed("hidden",true);
					graph.selectAll("circle").filter(".women").classed("hidden",true);
					plot.select("line[id=womenTrendline]").classed("hidden",true);
				}
				else {
					graph.selectAll("path").filter(".women").classed("hidden",false).transition().duration(500).attr('transform',function(d) { return 'translate('+xscale(d.date)+','+yscale(d.time_women)+')'; });
					graph.selectAll("circle").filter(".women").classed("hidden",false).attr("cx",function(d) { return xscale(d.date); }).attr("cy",function(d) { return yscale(d.time_women); }).style("fill","transparent").on("mouseover", function(d) {
						//Get this bar's x/y values, then augment for the tooltip
						var xPosition = xscale(d.date)+w_2+4;
						var yPosition = yscale(d.time_women)+h_2+padding*3-4;
						//Update the tooltip position and value
						d3.select("#tooltip").style("left",xPosition+"px").style("top",yPosition+"px").select("#year").text(d.year);
						d3.select("#tooltip").style("left",xPosition+"px").style("top",yPosition+"px").select("#time").text(d.time_women);
						//Show the tooltip
						d3.select("#tooltip").classed("hidden", false);
					}).on("mouseout",function(d) {
						d3.select("#tooltip").classed("hidden", true);
					});
					plot.select("line[id=womenTrendline]").classed("hidden",false).transition().duration(500).attr("x1",function(d) { return xscale(d[0]); }).attr("y1",function(d) { return yscale(d[1]); }).attr("x2",function(d) { return xscale(d[2]); }).attr("y2",function(d) { return yscale(d[3]); });
					graph.selectAll("path").filter(".men").classed("hidden",true);
					graph.selectAll("circle").filter(".men").classed("hidden",true);
					plot.select("line[id=menTrendline]").classed("hidden",true);
				}
			}
		</script>
	</body>
</html>
